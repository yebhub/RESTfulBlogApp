{"version":3,"sources":["../../src/interface.js"],"names":["util","require","RookMissingToken","RookUnsupportedNodeVersion","RookInvalidToken","RookInvalidOptions","RookOldServers","RookUnsupportedRuntime","trueValues","Rook","constructor","savedOptions","start","options","Object","keys","length","self","startAttempted","Promise","resolve","reject","singleton","debug","undefined","indexOf","process","env","ROOKOUT_DEBUG","log_to_stderr","ROOKOUT_LOG_TO_STDERR","log_file","ROOKOUT_LOG_FILE","LAMBDA_TASK_ROOT","lambda_safe_start","RookIllegalLambdaStart","log_level","ROOKOUT_LOG_LEVEL","throw_errors","skip_node_whitelist","ROOKOUT_SKIP_NODE_WHITELIST","checkVersionSupported","config","_verifyBoolean","LoggingConfiguration","LOG_TO_STDERR","_verifyString","LOG_LEVEL","FILE_NAME","tags","rawTags","ROOKOUT_ROOK_TAGS","tag","replace","split","push","StringUtils","trim","Array","isArray","labels","ROOKOUT_LABELS","label","kv","key","value","Map","originalLabels","_verifyLabel","DEBUG","git_commit","GitConfiguration","GIT_COMMIT","git_origin","GIT_ORIGIN","sources","parseSourcesList","SOURCES","maxScriptsFailSafe","ROOKOUT_MAX_SCRIPTS_COUNT_FAIL_SAFE","InstrumentationConfig","MAX_SCRIPTS_COUNT_FAIL_SAFE","maxScriptsSizeFailSafe","ROOKOUT_MAX_SCRIPTS_SIZE_FAIL_SAFE","MAX_SCRIPTS_SIZE_FAIL_SAFE","enableMonitor","enable_monitor","ROOKOUT_ENABLE_MONITOR","MonitorConfiguration","ENABLED","enableMemoryUsageLog","enable_memory_usage_log","ROOKOUT_ENABLE_MEMORY_USAGE_LOG","MemoryUsageLogService","memoryUsageLogFile","memory_usage_log_file","ROOKOUT_MEMORY_USAGE_LOG_FILE","LOG_FILE","enableTraceGC","enable_trace_gc","ROOKOUT_ENABLE_TRACE_GC","TRACE_GC_ENABLED","legacyLiveTailEnvVar","ROOKOUT_LIVE_TAIL","liveTailEnvVar","ROOKOUT_LIVE_LOGGER","consoleLiveLoggerEnvVar","ROOKOUT_CONSOLE_LIVE_LOGGER","liveTailProp","live_logger","legacyLiveTailProp","enable_livetail","enableLiveTail","LogHandlerService","CONSOLE_FUNCTIONS_HOOK_ENABLED","heapSnapshotsDirectory","heap_snapshots_directory","ROOKOUT_HEAP_SNAPSHOTS_DIRECTORY","HeapSnapshotConfiguration","HEAP_PATH","SIGNAL","heap_snapshots_signal","ROOKOUT_HEAP_SNAPSHOTS_SIGNAL","host","ROOKOUT_CONTROLLER_HOST","ROOKOUT_AGENT_HOST","port","ROOKOUT_CONTROLLER_PORT","ROOKOUT_AGENT_PORT","proxy","ROOKOUT_PROXY","token","ROOKOUT_TOKEN","logger","format","VersionConfiguration","VERSION","COMMIT","versions","node","_verifyToken","_print_options","substring","ControllerAddress","HOST","PORT","ROOKOUT_CONNECTION_TIMEOUT","AgentComConfiguration","TIMEOUT","connect","catch","e","console","log","message","error","stack","then","stop","close","flush","callback","notifyLambdaActive","context","notifyLambdaInactive","config_string","object","errorString","String","test","startsWith","RookInvalidLabel","nodeVersion","version","processMajorVersion","parseInt","processMinorVersion","processPatchVersion","isVersionBiggerOrEqual","biggerMajor","biggerMinor","biggerPatch","smallerMajor","smallerMinor","smallerPatch","sourcesList","ROOKOUT_SOURCES","source","origin","revision","originalSources","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst util = require('util');\nimport {StringUtils} from \"./utils\";\nimport { RookIllegalLambdaStart, RookInvalidLabel } from './exceptions';\n\nconst {RookMissingToken,\n    RookUnsupportedNodeVersion,\n    RookInvalidToken,\n    RookInvalidOptions,\n    RookOldServers,\n    RookUnsupportedRuntime} = require('./exceptions');\n\nconst trueValues = ['y', 'Y', 'yes',  'Yes',  'YES', 'true', 'True', 'TRUE', '1', true];\n\nclass Rook {\n    constructor() {\n        this.savedOptions = null;\n    }\n\n    start(options = {}) {\n        if (Object.keys(options).length === 0 && this.savedOptions !== null) {\n            options = this.savedOptions;\n        }\n\n        let self = this;\n        this.startAttempted = true;\n\n        return new Promise((resolve, reject) => {\n            try {\n                if (self.singleton) resolve();\n\n                self.debug = false;\n\n                if (options.debug === undefined) {\n                    self.debug = trueValues.indexOf(process.env.ROOKOUT_DEBUG) !== -1;\n                } else {\n                    self.debug = options.debug;\n                }\n\n                if (options.log_to_stderr === undefined && process.env.ROOKOUT_LOG_TO_STDERR !== undefined) {\n                    options.log_to_stderr = trueValues.indexOf(process.env.ROOKOUT_LOG_TO_STDERR) !== -1;\n                }\n\n                if (options.log_file === undefined && process.env.ROOKOUT_LOG_FILE !== undefined) {\n                    options.log_file = process.env.ROOKOUT_LOG_FILE;\n                }\n\n                if (process.env.LAMBDA_TASK_ROOT) {\n                    options.log_file = \"\";\n                    if (options.lambda_safe_start !== true) {\n                        throw new RookIllegalLambdaStart();\n                    }\n                }\n\n                options.log_level = options.log_level || process.env.ROOKOUT_LOG_LEVEL;\n\n                self.throw_errors = false;\n\n                if (options.throw_errors !== undefined) {\n                    self.throw_errors = options.throw_errors;\n                }\n\n                if (!(options.skip_node_whitelist || process.env.ROOKOUT_SKIP_NODE_WHITELIST)) {\n                    Rook.checkVersionSupported();\n                }\n\n                const config = require('./config');\n\n                Rook._verifyBoolean(self.throw_errors, 'Rook throw errors should be a boolean');\n\n                if (options.log_to_stderr !== undefined) {\n                    Rook._verifyBoolean(options.log_to_stderr, 'Rook log to stderr should be a boolean');\n                    config.LoggingConfiguration.LOG_TO_STDERR = options.log_to_stderr;\n                }\n\n                if (options.log_level !== undefined) {\n                    Rook._verifyString(options.log_level, 'Rook log level should be a String');\n                    config.LoggingConfiguration.LOG_LEVEL = options.log_level;\n                }\n\n                if (options.log_file !== undefined) {\n                    Rook._verifyString(options.log_file, 'Rook log file should be a String');\n                    config.LoggingConfiguration.FILE_NAME = options.log_file;\n                }\n\n                if (options.tags === undefined) {\n                    let rawTags = process.env.ROOKOUT_ROOK_TAGS;\n\n                    if (rawTags !== undefined) {\n                        options.tags = [];\n\n                        for (let tag of rawTags.replace(/['\"]/g, '').split(';')) {\n                            options.tags.push(StringUtils.trim(tag));\n                        }\n                    }\n                } else {\n                    if (Array.isArray(options.tags)) {\n                        for (let tag of options.tags) {\n                            Rook._verifyString(tag, 'Rook tags should be array of strings');\n                        }\n                    } else {\n                        throw new RookInvalidOptions('Rook tags should be array of strings');\n                    }\n                }\n\n                if (options.labels === undefined) {\n                    let labels = process.env.ROOKOUT_LABELS;\n                    if (labels !== undefined) {\n                        options.labels = {};\n\n                        for (let label of labels.replace(/['\"]/g, '').split(',')) {\n                            let kv = label.split(':');\n                            if (kv.length === 2) {\n                                let key = kv[0];\n                                let value = kv[1];\n\n                                if (key && value) {\n                                    options.labels[key] = value;\n                                }\n                            }\n                        }\n                    }\n                } else {\n                    // Normalize the map to native dictionary\n                    if (options.labels instanceof Map) {\n                        let originalLabels = options.labels;\n                        options.labels = {};\n                        for (let [key, value] of originalLabels) {\n                            options.labels[key] = value;\n                        }\n                    }\n\n                    for (let label of Object.keys(options.labels)) {\n                        // Set the label as an empty string if NULL\n                        if (options.labels[label] === undefined || options.labels[label] === null) {\n                            options.labels[label] = \"\";\n                        }\n\n                        Rook._verifyString(label);\n                        Rook._verifyString(options.labels[label], 'Rook label should be a map of strings');\n                        Rook._verifyLabel(label);\n                    }\n                }\n\n                Rook._verifyBoolean(self.debug, 'Rook debug flag should be a boolean');\n\n                if (self.debug) {\n                    config.LoggingConfiguration.LOG_LEVEL = 'DEBUG';\n                    config.LoggingConfiguration.LOG_TO_STDERR = true;\n                    config.LoggingConfiguration.DEBUG = true;\n                }\n\n                if (options.git_commit !== undefined) {\n                    Rook._verifyString(options.git_commit, 'Git commit should be a String');\n                    config.GitConfiguration.GIT_COMMIT = options.git_commit;\n                }\n\n                if (options.git_origin !== undefined) {\n                    Rook._verifyString(options.git_origin, 'Git origin should be a String');\n                    config.GitConfiguration.GIT_ORIGIN = options.git_origin;\n                }\n\n                options.sources = Rook.parseSourcesList(options.sources);\n\n                if (options.sources !== undefined) {\n                    config.GitConfiguration.SOURCES = options.sources;\n                }\n\n                let maxScriptsFailSafe = options.maxScriptsFailSafe || process.env.ROOKOUT_MAX_SCRIPTS_COUNT_FAIL_SAFE || config.InstrumentationConfig.MAX_SCRIPTS_COUNT_FAIL_SAFE;\n\n                config.InstrumentationConfig.MAX_SCRIPTS_COUNT_FAIL_SAFE = maxScriptsFailSafe;\n\n                let maxScriptsSizeFailSafe = options.maxScriptsSizeFailSafe || process.env.ROOKOUT_MAX_SCRIPTS_SIZE_FAIL_SAFE || config.InstrumentationConfig.MAX_SCRIPTS_SIZE_FAIL_SAFE;\n\n                config.InstrumentationConfig.MAX_SCRIPTS_SIZE_FAIL_SAFE = maxScriptsSizeFailSafe;\n\n                let enableMonitor = options.enable_monitor || process.env.ROOKOUT_ENABLE_MONITOR\n                    || config.MonitorConfiguration.ENABLED;\n\n                config.MonitorConfiguration.ENABLED = enableMonitor;\n\n                let enableMemoryUsageLog = options.enable_memory_usage_log || process.env.ROOKOUT_ENABLE_MEMORY_USAGE_LOG\n                    || config.MemoryUsageLogService.ENABLED;\n\n                config.MemoryUsageLogService.ENABLED = enableMemoryUsageLog;\n\n                let memoryUsageLogFile = options.memory_usage_log_file || process.env.ROOKOUT_MEMORY_USAGE_LOG_FILE\n                    || config.MemoryUsageLogService.LOG_FILE;\n\n                config.MemoryUsageLogService.LOG_FILE = memoryUsageLogFile;\n\n                let enableTraceGC = options.enable_trace_gc || process.env.ROOKOUT_ENABLE_TRACE_GC\n                    || config.MemoryUsageLogService.TRACE_GC_ENABLED;\n\n                config.MemoryUsageLogService.TRACE_GC_ENABLED = enableTraceGC;\n\n                let legacyLiveTailEnvVar = process.env.ROOKOUT_LIVE_TAIL;\n                let liveTailEnvVar = process.env.ROOKOUT_LIVE_LOGGER;\n                let consoleLiveLoggerEnvVar = process.env.ROOKOUT_CONSOLE_LIVE_LOGGER;\n                let liveTailProp = options.live_logger;\n                let legacyLiveTailProp = options.enable_livetail;\n                let enableLiveTail = liveTailProp || legacyLiveTailProp || liveTailEnvVar || legacyLiveTailEnvVar || consoleLiveLoggerEnvVar\n                    || config.LogHandlerService.ENABLED || config.LogHandlerService.CONSOLE_FUNCTIONS_HOOK_ENABLED;\n\n                config.LogHandlerService.ENABLED = enableLiveTail;\n                if (enableLiveTail) {\n                    config.LogHandlerService.CONSOLE_FUNCTIONS_HOOK_ENABLED = process.env.ROOKOUT_CONSOLE_LIVE_LOGGER || config.LogHandlerService.CONSOLE_FUNCTIONS_HOOK_ENABLED;\n\n                    if (options.labels) {\n                        options.labels[\"live_logger\"] = \"on\";\n                    } else {\n                        options.labels = { \"live_logger\": \"on\" };\n                    }\n\n                }\n\n                let heapSnapshotsDirectory = options.heap_snapshots_directory || process.env.ROOKOUT_HEAP_SNAPSHOTS_DIRECTORY;\n                if (heapSnapshotsDirectory) {\n                    config.HeapSnapshotConfiguration.HEAP_PATH = heapSnapshotsDirectory;\n\n                    config.HeapSnapshotConfiguration.SIGNAL = options.heap_snapshots_signal || process.env.ROOKOUT_HEAP_SNAPSHOTS_SIGNAL\n                    || config.HeapSnapshotConfiguration.SIGNAL;\n\n                }\n\n                let host = options.host || process.env.ROOKOUT_CONTROLLER_HOST || process.env.ROOKOUT_AGENT_HOST;\n                let port = options.port || process.env.ROOKOUT_CONTROLLER_PORT || process.env.ROOKOUT_AGENT_PORT;\n                let proxy = options.proxy || process.env.ROOKOUT_PROXY;\n                let token = options.token || process.env.ROOKOUT_TOKEN;\n\n                if (proxy !== undefined) {\n                    Rook._verifyString(proxy, 'proxy should be a string');\n                }\n\n                const {logger} = require('./logger');\n\n                logger.debug(util.format('Rookout SDK [%s]:[%s] for NodeJS [%s]', config.VersionConfiguration.VERSION,\n                    config.VersionConfiguration.COMMIT, process.versions.node));\n\n                if (host === undefined && token === undefined) {\n                    throw new RookMissingToken();\n                } else {\n                    if (token !== undefined) {\n                        Rook._verifyToken(token);\n                    }\n                }\n\n                if (this.debug) {\n                    Rook._print_options({\n                        token: (token !== undefined) ? token.substring(0, 5) + \".....\" : undefined,\n                        host: host,\n                        port: port,\n                        proxy: proxy,\n                        throw_errors: self.throw_errors,\n                        log_level: options.log_level,\n                        log_to_stderr: options.log_to_stderr,\n                        log_file: options.log_file,\n                        git_commit: options.git_commit,\n                        git_origin: options.git_origin,\n                        sources: options.sources,\n                        tags: options.tags,\n                        live_logger: options.live_logger,\n                        labels: options.labels\n                    });\n                }\n\n                host = host || config.ControllerAddress.HOST;\n                Rook._verifyString(host, 'Rook host should be String');\n\n                if ((host === \"staging.cloud.agent.rookout.com\") || (host === \"cloud.agent.rookout.com\")) {\n                    throw new RookOldServers();\n                }\n\n                port = port || config.ControllerAddress.PORT;\n                if (!((typeof port === 'number') || (typeof port === 'string'))) {\n                    throw new RookInvalidOptions('Rook port should be a Number or a String');\n                }\n\n                if (process.env.ROOKOUT_CONNECTION_TIMEOUT !== undefined) {\n                    if (typeof process.env.ROOKOUT_CONNECTION_TIMEOUT === 'number') {\n                        config.AgentComConfiguration.TIMEOUT = process.env.ROOKOUT_CONNECTION_TIMEOUT;\n                    }\n                }\n\n                this.savedOptions = options;\n                self.singleton = require('./singleton').singleton;\n                self.singleton.connect(token, host, port, proxy, options.tags, options.labels, this.debug, this.throw_errors).catch((e) => {\n                    if (self.throw_errors) {\n                        reject(e);\n                    } else {\n                        if (e instanceof RookInvalidToken || e instanceof RookOldServers || e instanceof RookIllegalLambdaStart) {\n                            console.log('[Rookout] ', e.message);\n                        } else {\n                            console.error('[Rookout] Failed to connect to the controller - will continue attempting in the background: ', e.message);\n                        }\n\n                        if (self.debug) {\n                            console.error(e.stack || e);\n                        }\n\n                        resolve(self);\n                    }\n                }).then(() => resolve(self));\n            } catch (e) {\n                if (self.throw_errors) {\n                    reject(e);\n                } else {\n                    console.error('[Rookout] Failed to start Rookout: ', e.message);\n\n                    if (self.debug) {\n                        console.error(e.stack || e);\n                    }\n\n                    resolve(self);\n                }\n            }\n        });\n    }\n\n    async stop() {\n        if (!this.singleton) return;\n\n        try {\n            const singleton = this.singleton;\n            this.singleton = undefined;\n            await singleton.close();\n        } catch (e) {\n            if (this.throw_errors) {\n                throw e;\n            }\n\n            if (this.debug) {\n                console.error(e.stack || e);\n            }\n        }\n    }\n\n    flush(callback) {\n        if (!this.singleton) {\n            if (callback !== undefined) {\n                callback();\n            }\n            return;\n        }\n\n        try {\n            this.singleton.flush(callback);\n        } catch (e) {\n            if (this.throw_errors) {\n                throw e;\n            }\n\n            if (this.debug) {\n                console.error(e.stack || e);\n            }\n        }\n    }\n\n    notifyLambdaActive(context) {\n        if (!this.singleton) {\n            console.error('[Rookout] Initialization error');\n            return;\n        }\n\n        this.singleton.notifyLambdaActive(context);\n    }\n\n    notifyLambdaInactive() {\n        if (!this.singleton) {\n            console.error('[Rookout] Initialization error');\n            return;\n        }\n\n        this.singleton.notifyLambdaInactive();\n    }\n\n    static _print_options(options = {}) {\n        try {\n            let config_string = \"\";\n            for (let key in options) {\n                if (options[key] !== undefined) {\n                    config_string = config_string + key + \": \" + options[key] + \", \";\n                }\n            }\n            console.log(\"RookOptions: \" + config_string);\n        } catch (e) { }\n    }\n\n    static _verifyBoolean(object, errorString) {\n        if (!(typeof object === 'boolean')) {\n            throw new RookInvalidOptions(errorString);\n        }\n    };\n\n    static _verifyString(object, errorString) {\n        if (!(typeof object === 'string' || object instanceof String)) {\n            throw new RookInvalidOptions(errorString);\n        }\n    };\n\n    static _verifyToken(object) {\n        Rook._verifyString(object, 'Rookout token should be a String');\n\n        if (object.length !== 64) {\n            throw new RookInvalidOptions('Rookout token should be 64 characters');\n        }\n\n        if (/^[0-9a-zA-Z]+$/.test(object) === false) {\n            throw new RookInvalidOptions('Rookout token must consist of only hexadecimal characters')\n        }\n    };\n\n    static _verifyLabel(label) {\n        if (label.startsWith(\"$\")) {\n            throw new RookInvalidLabel(label);\n        }\n    }\n\n    static checkVersionSupported() {\n        if (!process || !process.versions || !process.versions.node) {\n            throw new RookUnsupportedRuntime();\n        }\n\n        let nodeVersion = process.versions.node;\n        let version = nodeVersion.split(\".\");\n\n        if (version.length < 3) {\n            throw new RookUnsupportedRuntime();\n        }\n\n        let processMajorVersion = parseInt(version[0]);\n        let processMinorVersion = parseInt(version[1]);\n        let processPatchVersion = parseInt(version[2]);\n        \n        // Validating not 8.9.1\n        if ((processMajorVersion === 8 && processMinorVersion === 9 && processPatchVersion === 1)\n            || \n            (\n                // Validating that 8.0.0 <= currentProcessVersion <= 12.22.7\n                !(Rook.isVersionBiggerOrEqual(processMajorVersion, processMinorVersion, processPatchVersion, 8, 0, 0)\n                && Rook.isVersionBiggerOrEqual(12, 22, 7, processMajorVersion, processMinorVersion, processPatchVersion))\n                && \n                // Validating that 14.0.0 <= currentProcessVersion <= 14.18.1 \n                !(Rook.isVersionBiggerOrEqual(processMajorVersion, processMinorVersion, processPatchVersion, 14, 0, 0)\n                && Rook.isVersionBiggerOrEqual(14, 18, 1, processMajorVersion, processMinorVersion, processPatchVersion))\n                && \n                // Validating that 16.0.0 <= currentProcessVersion <= 16.13.1 \n                !(Rook.isVersionBiggerOrEqual(processMajorVersion, processMinorVersion, processPatchVersion, 16, 0, 0)\n                && Rook.isVersionBiggerOrEqual(16, 13, 1, processMajorVersion, processMinorVersion, processPatchVersion))            \n            )\n            ) {\n            throw new RookUnsupportedNodeVersion(nodeVersion);\n        }\n    }\n\n    static isVersionBiggerOrEqual(biggerMajor, biggerMinor, biggerPatch, smallerMajor, smallerMinor, smallerPatch) {\n        return biggerMajor > smallerMajor\n            || (biggerMajor === smallerMajor\n                && (biggerMinor > smallerMinor\n                    || (biggerMinor === smallerMinor && biggerPatch >= smallerPatch)));\n    }\n\n    static parseSourcesList(sourcesList) {\n        if (sourcesList === undefined) {\n            let sources = process.env.ROOKOUT_SOURCES;\n            if (sources !== undefined) {\n                sourcesList = {};\n                for (let source of sources.replace(/['\"]/g, '').split(';')) {\n                    let kv = source.split('#');\n                    if (kv.length === 2) {\n                        let origin = kv[0];\n                        let revision = kv[1];\n\n                        if (origin && revision) {\n                            sourcesList[origin] = revision;\n                        }\n                    }\n                }\n            }\n        } else {\n            // Normalize the map to native dictionary\n            if (sourcesList instanceof Map) {\n                let originalSources = sourcesList;\n                sourcesList = {};\n                for (let [origin, revision] of originalSources) {\n                    sourcesList[origin] = revision;\n                }\n            }\n\n            for (let origin of Object.keys(sourcesList)) {\n                Rook._verifyString(origin, 'Remote origin in source list should be a string');\n                Rook._verifyString(sourcesList[origin], 'Revision in source list should be a string');\n            }\n        }\n        return sourcesList;\n    }\n}\n\nmodule.exports = Rook;\n"],"file":"interface.js"}